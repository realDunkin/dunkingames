<html>
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title id="title">Home - Dunkin's Games</title>
      <link rel="shortcut icon" type="image/png" href="images/favicon.png">
      <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  </head>
  <style>
    .Fantasy {
      font-family: "Fantasy", Helvetica, sans-serif;
      color: rgb(255, 255, 255);
      -webkit-text-stroke-width: 1px;
      -webkit-text-stroke-color: rgb(0, 0, 0);
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(4, 250px);
      padding: 20px;
      column-gap: 25px;
      row-gap: 25px;
      justify-content: center;
    }
    .grid-item {
      background-color: #cccccc;
      border: 3px solid rgba(0, 0, 0, 0.8);
      padding: 50px;
      font-size: 20px;
      align-content: center;
      word-wrap: break-word;
      font-family: "Fantasy", Helvetica, sans-serif;
      color: rgb(255, 255, 255);
      -webkit-text-stroke-width: 1px;
      -webkit-text-stroke-color: rgb(0, 0, 0);
    }
    .grid-item:hover {
        background-color: #7acca2;
        transition: .2s all;
    }
    .daTbl {
      font-family: "Fantasy", Helvetica, sans-serif;
      background-color: #cccccc;
      border: 3px solid black;
      padding: 15px;
      border-spacing: 20px;
    }
    .Button {
      font-family: "Fantasy", Helvetica, sans-serif;
      background-color: #cccccc;
    }
    .Button:hover {
      font-family: "Fantasy", Helvetica, sans-serif;
      background-color: #7acca2;
    }
  </style>
  <body background="images/background.png">
    <div id="Variables" style="display: none;">
      <input type="text" id="GAMEURL" value=""></input>
      <input type="text" id="GAMETYPE" value=""></input>
    </div>
    <div id="MainText" class="Fantasy">
      <center>
        <strong>
          <br><br>
          <a style="font-size: 32px;" href="#" onclick="showMainBody()">Dunkin's Games</a>
          <p id="subTEXT" style="font-size: 24px;"></p>
          <br>
        </strong>
      </center>
    </div>
    <div id="MainBody" style="display: block;">
      <div id="Sort" class="Fantasy">
        <center>
          <input type="text" id="searchBox" placeholder="Search Game..." onchange="makeList()"></input>
          <br>
          <select id="listSort" size="1"  onchange="makeList()">
            <option value="New-Old">Sort By: Newest To Oldest</option>
            <option value="Old-New">Sort By: Oldest To Newest</option>
            <option value="A-Z">Sort By: A To Z</option>
            <option value="Z-A">Sort By: Z To A</option>
          </select>
          <br><br>
        </center>
      </div>
      <div id="ChartBody" class="Fantasy">
        <center>
          <div id="DaChart" class="grid-container" style="width:100%; height:100%;">
            
          </div>
        </center>
      </div>
    </div>
    <div id="GameBody">
      <center>
        <div id="GameWindow">
          
        </div>
      </center>
      <div id="AfterGameWindow">
        <center>
          <strong>
            <br><br>
            <button id="FullscreenButton" class="Button" onclick="openFullscreen();" style="font-size: 25px; display: none;">Fullscreen</button>
             <br><br>
             <div id="DescriptionBox" class="daTbl" style="width:50%; height:25%;">
              
             </div>
          </strong>
        </center>
      </div>
    </div>
    <div id="EndBody">
      <br><br><br><br>
      <p> </p><a style="font-size: 15px;" href="https://github.com/realDunkin/dunkingames">Created and Maintained By realDunkin - I Don't Own Any Games Here - Want To Put Some Of These Games On Your Own Page?</a>
    </div>
    <script>
      function showMainBody(){
        document.getElementById("MainBody").style.display = "block";
        document.getElementById("GameBody").style.display = "none";

        document.getElementById("title").innerHTML = "Home - Dunkin's Games";
        document.getElementById("subTEXT").innerHTML = "No Ads, Just Games!";
        if (document.getElementById("GAMEURL").value != ""){
          document.getElementById("FullscreenButton").style.display = "none";
          document.getElementById("GameElement").remove();
          document.getElementById("DescriptionBox").innerHTML = "";
          document.getElementById("GAMEURL").value = "";
          document.getElementById("GAMETYPE").value = "";
        }
        makeList();
      }
      function setURL(urlString){
        document.getElementById("GAMEURL").value = urlString;
        curURL = window.location.href.replace("#", "");
        newURL = window.location.origin + "/dunkingames/"
        console.log(curURL + " === " + newURL);
        if(curURL === newURL){
          window.location.href = newURL + "#" + urlString;
          console.log("yes");
        }
        showGameBody();
      }
      function clearList(){
        document.getElementById("DaChart").innerHTML = "";
      }
      function matchSearch(data){
        var jsonData = Object.assign({}, data, {});
        console.log("The Starting Data:");
        console.log(jsonData)
        var max = data.games.length;
        var removed = 0;
        searchValue = document.getElementById("searchBox").value.toLowerCase();
        if(searchValue != ""){
          for (let index in data.games) {
            var dataName = data.games[index].name.toLowerCase()
            if (dataName.includes(searchValue) === false) {
                for (let index2 in jsonData.games) {
                  var jsonName = jsonData.games[index2].name.toLowerCase();
                  if (jsonName === dataName){
                    delete jsonData.games[index2];
                    removed += 1;
                  }
                }
            }
          }
        }
        console.log("The Ending Data:");
        console.log(jsonData);
        console.log("Filtered For: " + searchValue + " | Total Before: " + max + " | Total After: " + (max - removed) + " | Total Removed: " + removed);
        return jsonData;
      }
      function sortByNewOld(a, b) {
        if (a.id > b.id) {
          return -1;
        }
        if (a.id < b.id) {
          return 1;
        }
        return 0;
      }
      function sortByOldNew(a, b) {
        if (a.id < b.id) {
          return -1;
        }
        if (a.id > b.id) {
          return 1;
        }
        return 0;
      }
      function sortByAZ(a, b) {
        if (a.name < b.name) {
          return -1;
        }
        if (a.name > b.name) {
          return 1;
        }
        return 0;
      }
      function sortByZA(a, b) {
        if (a.name > b.name) {
          return -1;
        }
        if (a.name < b.name) {
          return 1;
        }
        return 0;
      }
      function makeList(){
        clearList();
        fetch("gameData.json").then(response => response.json()).then(data => {
          sortValue = document.getElementById("listSort").value;
          switch (sortValue) {
            case "New-Old":
              data.games.sort(sortByNewOld);
              console.log("Sorted By: Newest To Oldest");
              break;
            case "Old-New":
              data.games.sort(sortByOldNew);
              console.log("Sorted By: Oldest To Newest");
              break;
            case "A-Z":
              data.games.sort(sortByAZ);
              console.log("Sorted By: A To Z");
              break;
            case "Z-A":
              data.games.sort(sortByZA);
              console.log("Sorted By: Z To A");
              break;
            default:
              console.log("Sorted By: None");
              break;
          }
          data = matchSearch(data);
          for (let index in data.games) {
              daUrl = 'setURL("' + data.games[index].url + '")';
              imgUrl = data.games[index].url + "-thumbnail";
              parsestring = "<div class='grid-item' onclick='" + daUrl + "'><img src='images/thumbnails/" + data.games[index].url + ".png' alt=" + imgUrl + " width='100' height='100'><br><br><a>" + data.games[index].name + "</a></div>";
              parser = new DOMParser();
              doc = parser.parseFromString(parsestring, 'text/html');
              element = doc.body.firstChild;
              document.getElementById("DaChart").appendChild(element);
          }
        })
      }
      function fullscreenchanged(event) {
        if (document.fullscreenElement){
          console.log("Entered Fullscreen Somewhere")
        }
        else {
          console.log("Leaving Fullscreen Somewhere")
          url = window.location.href;
          url = url.replace("#fullscreen", "");
          window.location.href = url;
        }
      }
      function openFullscreen() {
        var GAMETYPE = document.getElementById("GAMETYPE").value;
        switch (GAMETYPE) {
          case "flash":
            console.log("Fullscreen Flash Content");
            document.getElementById("GameElement").enterFullscreen();
            break;
          case "html5":
            console.log("Fullscreen HTML5 Content");
            document.getElementById("GameElement").requestFullscreen();
              break;
          default:
            console.log("Do Nothing");
            break;
        }
      }
      function showGameBody(){
        document.getElementById("MainBody").style.display = "none";
        document.getElementById("GameBody").style.display = "block";
        var url = document.getElementById("GAMEURL").value;
        console.log(url);
        fetch("gameData.json").then(response => response.json()).then(data => {
          var mached = false;
          for (let index = 0; index < data.games.length; index++) {
            if (url == data.games[index].url) {
              console.log("Matched");
              name = data.games[index].name;
              document.getElementById("title").innerHTML = name + " - Dunkin's Games";
              document.getElementById("subTEXT").innerHTML = name;
              var parsestring = "";
              switch (data.games[index].data.gameType){
                case "flash":
                  parsestring = '<object value="flash" name="GameElement" id="GameElement" type="application/x-shockwave-flash" data="games/' + data.games[index].data.gameFile + '" width="' + data.games[index].data.width + '" height="' + data.games[index].data.height + '"><param id="MovieValue" name="movie" value="games/' + data.games[index].data.gameFile + '" /><param name="quality" value="high" /><param name="play" value="true" /><param name="loop" value="true" /><param name="wmode" value="window" /><param name="scale" value="showall" /><param name="menu" value="true" /><param name="devicefont" value="false" /><param name="salign" value="" /><param name="allowScriptAccess" value="sameDomain" /><param name="allowFullScreen" value="true" /></object>';
                  console.log("This A Flash Game");
                  break;
                case "html5":
                  parsestring = '<div value="html5" name="GameElement" id="GameElement" style="width:' + data.games[index].data.width + 'px; height:' + data.games[index].data.height + 'px;" bis_skin_checked="1"><iframe id="iframe" width="100%" height="100%" src=games/' + data.games[index].url + '/' + data.games[index].data.gameFile + ' tabindex="0" scrolling="no" style="border: none; overflow: hidden" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div>';
                  console.log("This A HTML5 Game");
                  break;
                default:
                  console.log("This Nothing");
                  break;
              }
              descstring = "<table class='daTbl'><tr><th style='font-size: 24px;'>Game Description</th></tr><tr><td style='font-size: 16px;'>" + data.games[index].description + "</td></tr></table>";
              parser = new DOMParser();
              doc = parser.parseFromString(parsestring, 'text/html');
              element = doc.body.firstChild;
              document.getElementById("GameWindow").appendChild(element);
              doc2 = parser.parseFromString(descstring, 'text/html');
              descElement = doc2.body.firstChild;
              document.getElementById("DescriptionBox").appendChild(descElement);
              document.getElementById("FullscreenButton").style.display = "block";
              document.getElementById("GAMETYPE").value = data.games[index].data.gameType;
              mached = true;
              console.log("Done!");
            }
          }
          if(mached === false){
            console.log("Error");
            document.getElementById("title").innerHTML = name + "An Error Occured - Dunkin's Games";
            document.getElementById("subTEXT").innerHTML = "Something Went Wrong, Either This Game URL Changed Or Does Not Exist Anymore";
            parsestring = '<img id="GameElement" src="images/hmm.png" alt="Hmm..." width="500" height="500">';
            parser = new DOMParser();
            doc = parser.parseFromString(parsestring, 'text/html');
            element = doc.body.firstChild;
            document.getElementById("GameWindow").appendChild(element);
          }
        })			
      }
      var urlLocation = window.location.href;
      urlLocation = urlLocation.split("/");
      if(urlLocation[urlLocation.length - 1].includes("#") === true){
        urlLocation2 = urlLocation[urlLocation.length - 1]
        fullscreenchanged(null);
        final = urlLocation2.split("#");
        if (final[final.length - 1] === ""){
          showMainBody();
        }
        else{
          if(final[final.length - 1] === "fullscreen"){
            setURL(final[final.length - 2]);
          }
          else{
            setURL(final[final.length - 1]);
          }
        }
      }
      else{
        showMainBody();
      }
      document.addEventListener("fullscreenchange", fullscreenchanged);
    </script>
  </body>
</html>
