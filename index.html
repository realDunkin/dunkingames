<!DOCTYPE html>
<html>
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title id="title">Home - Dunkin's Games</title>
      <link rel="shortcut icon" type="image/png" href="images/favicon.png">
      <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  </head>
  <style>
    .Fantasy {
      font-family: "Fantasy", Helvetica, sans-serif;
      color: rgb(255, 255, 255);
      -webkit-text-stroke-width: 1px;
      -webkit-text-stroke-color: rgb(0, 0, 0);
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 250px);
      padding: 20px;
      column-gap: 25px;
      row-gap: 25px;
      justify-content: center;
    }
    .grid-item {
      font-family: "Fantasy", Helvetica, sans-serif;
      background-color: #cccccc;
      border: 3px solid rgba(0, 0, 0, 0.8);
      padding: 50px;
      font-size: 20px;
      align-content: center;
      word-wrap: break-word;
      font-family: "Fantasy", Helvetica, sans-serif;
    }
    .grid-item:hover {
        background-color: #7acca2;
        transition: .5s all;
    }
    .grid-item-broken {
      font-family: "Fantasy", Helvetica, sans-serif;
      background-color: #8f8d8d;
      border: 3px solid rgba(0, 0, 0, 0.8);
      padding: 50px;
      font-size: 20px;
      align-content: center;
      word-wrap: break-word;
      font-family: "Fantasy", Helvetica, sans-serif;
    }
    .grid-item-broken:hover {
        background-color: #cc7a7e;
        transition: .5s all;
    }
    .daTbl {
      font-family: "Fantasy", Helvetica, sans-serif;
      background-color: #cccccc;
      border: 3px solid black;
      padding: 10px;
      border-spacing: 20px;
    }
    .Button {
      font-family: "Fantasy", Helvetica, sans-serif;
      background-color: #cccccc;
    }
    .Button:hover {
      font-family: "Fantasy", Helvetica, sans-serif;
      background-color: #7acca2;
      transition: .5s all;
    }
    .Button-Broken {
      font-family: "Fantasy", Helvetica, sans-serif;
      background-color: #8f8d8d;
    }
    .Button-Broken:hover {
      font-family: "Fantasy", Helvetica, sans-serif;
      background-color: #cc7a7e;
      transition: .5s all;
    }
  </style>
  <body background="images/background.png">
    <img id="menuIcon" onclick="openOverlayMenu()" src="images/menu-icon.png" width="50" height="50" style="position: fixed; z-index: 1; bottom: 2%; left: 2%; display: block;">
    <div id="Variables" style="display: none;">
      <input type="text" id="GAMEURL" value=""></input>
      <input type="text" id="GAMETYPE" value=""></input>
    </div>
    <div id="OverlayBody" style="="position: fixed; z-index: -1;">
      <div id="OverlayBackground" onclick="closeOverlayMenu()" style="position: fixed; z-index: -1; bottom: 0; top: 0; left: 0; right: 0; width: 100%; height: 100%; background-color:black; opacity: 0.5; display: none;">
        
      </div>
      <div id="OverlayMainMenu" style="position: fixed; overflow-y: auto; z-index: 0; top: 0; left: 0; width: 25%; height: 100%; background-image: url('images/menu-background.png'); display: none;">
        <center>
            <strong>
              <p class="Fantasy" style="font-size: 24px;">Main Menu</p>
            </strong>
            <div id="DaMainMenu" class="Fantasy" style="width: 100%; height: 50%; top: 5%; left: 50%;">
              
            <div/>
        </center>
      </div>
    </div>
    <div id="MainText" class="Fantasy">
      <center>
        <strong>
          <br><br>
          <a style="font-size: 32px;" href="#" onclick="showMainBody()">Dunkin's Games</a>
          <p id="subTEXT" style="font-size: 24px;"></p>
          <br>
        </strong>
      </center>
    </div>
    <div id="MainBody" style="display: none;">
      <div id="Sort" class="Fantasy">
        <center>
          <input type="text" id="searchBox" placeholder="Search Game..." onchange="makeList()"></input>
          <br>
          <select id="listSort" size="1"  onchange="makeList()">
            <option value="New-Old">Sort By: Newest To Oldest</option>
            <option value="Old-New">Sort By: Oldest To Newest</option>
            <option value="A-Z">Sort By: A To Z</option>
            <option value="Z-A">Sort By: Z To A</option>
          </select>
          <br>
          <select id="listFilter" size="1" onchange="makeList()">
            <option value="None">Filter By: None</option>
            <option value="SinglePlayer">Filter By: Single Player Games</option>
            <option value="LocalMultiplayer">Filter By: Local Multiplayer Games</option>
            <option value="OnlineMultiplayer">Filter By: Online Multiplayer Games</option>
          </select>
          <br><br>
          <button id="surpriseMe" class="Button" onclick="surpriseMe(false);">Surprise Me!</button>
          <br><br>
        </center>
      </div>
      <div id="ChartBody">
        <center>
          <div id="DaChart" class="grid-container" style="width:0%; height:100%;">
            
          </div>
        </center>
      </div>
    </div>
    <div id="GameBody" style="display: none;">
      <center>
        <div id="GameWindow">
          
        </div>
      </center>
      <div id="AfterGameWindow">
        <center>
          <strong>
            <br><br>
            <button id="FullscreenButton" class="Button" onclick="openFullscreen();" style="font-size: 25px; display: none;">Fullscreen</button>
            <br><br>
            <div id="DescriptionBox" class="daTbl" style="width:50%; height:25%;">
              
            </div>
          </strong>
        </center>
      </div>
    </div>
    <div id="Footer">
      <br><br><br><br>
      <center>
        <strong>
          <a style="font-size: 12px;" href="https://github.com/realDunkin/dunkingames">Created and Maintained By realDunkin - I Don't Own Any Games Here - Want To Put Some Of These Games On Your Own Page?</a>
          <br><br>
          <button id="SuggestionButton" class="Button" onclick="discord_suggestion();" style="font-size: 15px;  display: block;">Suggest A Game</button>
          <button id="BugButton" class="Button" onclick="discord_bug_report();" style="font-size: 15px;  display: none;">Report An Issue</button>
        </strong>
      </center>
    </div>
    <script>
      function openOverlayMenu() {
        menuOpen = true
        document.getElementById("OverlayBody").style.zIndex = "1";
        document.getElementById("OverlayBackground").style.zIndex = "2";
        document.getElementById("OverlayBackground").style.display = "block";
        document.getElementById("OverlayMainMenu").style.zIndex = "3";
        document.getElementById("OverlayMainMenu").style.display = "block";
      }
      function closeOverlayMenu() {
        menuOpen = false
        document.getElementById("OverlayBody").style.zIndex = "-1";
        document.getElementById("OverlayBackground").style.zIndex = "-1";
        document.getElementById("OverlayBackground").style.display = "none";
        document.getElementById("OverlayMainMenu").style.zIndex = "-1";
        document.getElementById("OverlayMainMenu").style.display = "none";
      }
      function discord_suggestion() {
        let initData = JSON.parse(JSON.stringify(gameData));
        let webHookURL = initData.webhooks[0].url
        let person = prompt("Please enter the website url of the game! :)", "");
        if (person == null || person == "") {
          console.log("Failed To Send Suggestion");
        }
        else {
          console.log("Sending Suggestion");
          var xhr = new XMLHttpRequest();
          xhr.open("POST", webHookURL, true);
          //xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
          xhr.send(JSON.stringify({
            "content": "",
            "tts": false,
            "embeds": [
              {
                "id": 583052741,
                "description": "",
                "fields": [
                  {
                    "id": 169653019,
                    "name": "URL:",
                    "value": "[Game Link](" + person + ")",
                    "inline": true
                  }
                ],
                "title": "Game Suggestion!",
                "color": 65393
              }
            ],
            "components": [],
            "actions": {}
          }));
        }
      }

      function discord_bug_report() {
        let initData = JSON.parse(JSON.stringify(gameData));
        let webHookURL = initData.webhooks[1].url;
        let gameName = document.getElementById("subTEXT").innerHTML;
        let gameURL = document.getElementById("GAMEURL").value;
        let thisURL = window.location.href;
        let person = prompt("Please describe whats wrong with this game :(", "");
        if (person == null || person == "") {
          console.log("Failed To Send Suggestion");
        }
        else {
          console.log("Sending Suggestion");
          var xhr = new XMLHttpRequest();
          xhr.open("POST", webHookURL, true);
          //xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
          xhr.send(JSON.stringify({
            "content": "",
            "tts": false,
            "embeds": [
              {
                "id": 583052741,
                "title": "Bug Report",
                "description": person,
                "color": 16711680,
                "thumbnail": {
                  "url": window.location.origin + window.location.pathname + "images/thumbnails/" + gameURL + ".png"
                },
                "fields": [
                  {
                    "id": 169653019,
                    "name": gameName + ":",
                    "value": "[Game URL](" + thisURL + ")",
                    "inline": true
                  }
                ]
              }
            ],
            "components": [],
            "actions": {}
          }));
        }
      }

      function showMainBody(){
        closeOverlayMenu()
        document.getElementById("MainBody").style.display = "block";
        document.getElementById("GameBody").style.display = "none";
        document.getElementById("SuggestionButton").style.display = "block";
        document.getElementById("BugButton").style.display = "none";

        document.getElementById("title").innerHTML = "Home - Dunkin's Games";
        document.getElementById("subTEXT").innerHTML = "No Ads, Just Games!";
        if (document.getElementById("GAMEURL").value != ""){
          document.getElementById("FullscreenButton").style.display = "none";
          document.getElementById("GameElement").remove();
          document.getElementById("DescriptionBox").innerHTML = "";
          document.getElementById("GAMEURL").value = "";
          document.getElementById("GAMETYPE").value = "";
        }
        document.getElementById("MainText").scrollIntoView({ behavior: 'smooth'})
        makeList();
      }
      function switchGameMenu(urlString){
        document.getElementById("MainBody").style.display = "none";
        document.getElementById("GameBody").style.display = "none";
        document.getElementById("SuggestionButton").style.display = "none";
        document.getElementById("BugButton").style.display = "none";
        
        if (document.getElementById("GAMEURL").value != ""){
          document.getElementById("FullscreenButton").style.display = "none";
          document.getElementById("GameElement").remove();
          document.getElementById("DescriptionBox").innerHTML = "";
        }
        
        document.getElementById("GAMEURL").value = urlString;
        newURL = window.location.origin + "/dunkingames/"
        window.location.href = newURL + "#" + urlString;
        showGameBody();
      }
      function setURL(urlString){
        document.getElementById("GAMEURL").value = urlString;
        curURL = window.location.href.replace("#", "");
        newURL = window.location.origin + "/dunkingames/"
        console.log(curURL + " === " + newURL);
        if(curURL === newURL){
          window.location.href = newURL + "#" + urlString;
          console.log("yes");
        }
        showGameBody();
      }
      function clearList(){
        document.getElementById("DaChart").innerHTML = "";
      }
      function surpriseMe(fromMenu){
        let urlList = [];
        let maxNum = 0;
        for (let index in gameData.games) {
            if(gameData.games[index].isWorking){
              urlList.push(gameData.games[index].url);
              maxNum += 1;
            }
        }
        randomNum = Math.floor(Math.random() * maxNum);
        
        if(fromMenu === false){
          setURL(urlList[randomNum]);
        }
        else{
          switchGameMenu(urlList[randomNum]);
        }
      }
      function matchSearch(data){
        let jsonData = JSON.parse(JSON.stringify(data));
        let max = data.games.length;
        let removed = 0;
        searchValue = document.getElementById("searchBox").value.toLowerCase();
        tagValue = document.getElementById("listFilter").value;
        if(tagValue !== "None"){
          for(let index in data.games) {
            let dataUrl = data.games[index].url;
            let dataTags = data.games[index].tags;
            let removeData = true;
            for(let tIndex in dataTags){
             if(dataTags[tIndex] === tagValue){
               removeData = false;
             }
            }
            if (removeData === true){
             for(let index2 in jsonData.games){
                let jsonDataUrl = jsonData.games[index2].url
                if(dataUrl === jsonDataUrl){
                  delete jsonData.games[index2];
                  removed += 1;
                }
              } 
            }
          }
        }
        if(searchValue != ""){
          for (let index in data.games) {
            let dataName = data.games[index].name.toLowerCase()
            if (dataName.includes(searchValue) === false) {
                for (let index2 in jsonData.games) {
                  let jsonName = jsonData.games[index2].name.toLowerCase();
                  if (jsonName === dataName){
                    delete jsonData.games[index2];
                    removed += 1;
                  }
                }
            }
          }
        }
        console.log("The Ending Data:");
        console.log(jsonData);
        console.log("Filtered For: " + searchValue + " | Total Before: " + max + " | Total After: " + (max - removed) + " | Total Removed: " + removed);
        return jsonData;
      }
      function sortByNewOld(a, b) {
        if (a.id > b.id) {
          return -1;
        }
        if (a.id < b.id) {
          return 1;
        }
        return 0;
      }
      function sortByOldNew(a, b) {
        if (a.id < b.id) {
          return -1;
        }
        if (a.id > b.id) {
          return 1;
        }
        return 0;
      }
      function sortByAZ(a, b) {
        if (a.name.toLowerCase() < b.name.toLowerCase()) {
          return -1;
        }
        if (a.name.toLowerCase() > b.name.toLowerCase()) {
          return 1;
        }
        return 0;
      }
      function sortByZA(a, b) {
        if (a.name.toLowerCase() > b.name.toLowerCase()) {
          return -1;
        }
        if (a.name.toLowerCase() < b.name.toLowerCase()) {
          return 1;
        }
        return 0;
      }
      function makeMenuList() {
        let initData = JSON.parse(JSON.stringify(gameData));
        let parsestring = '<div><strong><p style="font-size: 18px;">----------------</p><button style="font-size: 18px;" class="Button" onclick="showMainBody();">Home</button><br><br><button style="font-size: 18px;" class="Button" onclick="surpriseMe(true);">Random Game</button><p style="font-size: 18px;">----Games----</p>';
        for (let index in initData.games) {
            daUrl = "switchGameMenu('" + initData.games[index].url + "')";
            if(initData.games[index].isWorking){
              parsestring += '<button style="font-size: 18px;" class="Button" onclick="' + daUrl + '">' + initData.games[index].name + '</button><br><br>';
            }
            else{
              parsestring += '<button style="font-size: 18px;" class="Button-Broken"><del>' + initData.games[index].name + '</del></button><br><br>';
            }
        }
        parsestring += '</strong></div>'
        parser = new DOMParser();
        doc = parser.parseFromString(parsestring, 'text/html');
        element = doc.body.firstChild;
        document.getElementById("DaMainMenu").appendChild(element);
      }
      function makeList(){
        clearList();
        let initData = JSON.parse(JSON.stringify(gameData));
        sortValue = document.getElementById("listSort").value;
        switch (sortValue) {
          case "New-Old":
            initData.games.sort(sortByNewOld);
            console.log("Sorted By: Newest To Oldest");
            break;
          case "Old-New":
            initData.games.sort(sortByOldNew);
            console.log("Sorted By: Oldest To Newest");
            break;
          case "A-Z":
            initData.games.sort(sortByAZ);
            console.log("Sorted By: A To Z");
            break;
          case "Z-A":
            initData.games.sort(sortByZA);
            console.log("Sorted By: Z To A");
            break;
          default:
            console.log("Sorted By: None");
            break;
        }
        copyData = matchSearch(initData);
        for (let index in copyData.games) {
            daUrl = 'setURL("' + copyData.games[index].url + '")';
            imgUrl = copyData.games[index].url + "-thumbnail";
            parsestring = "";
            if(copyData.games[index].isWorking){
              parsestring = "<div class='grid-item' onclick='" + daUrl + "'><img src='images/thumbnails/" + copyData.games[index].url + ".png' alt=" + imgUrl + " width='100' height='100'><br><br><a>" + copyData.games[index].name + "</a></div>";
            }
            else{
              parsestring = "<div class='grid-item-broken'><img src='images/thumbnails/" + copyData.games[index].url + ".png' alt=" + imgUrl + " width='100' height='100'><br><br><a><del>" + copyData.games[index].name + "</del></a></div>";  
            }
            parser = new DOMParser();
            doc = parser.parseFromString(parsestring, 'text/html');
            element = doc.body.firstChild;
            document.getElementById("DaChart").appendChild(element);
        }
      }
      function fullscreenchanged(event) {
        if (document.fullscreenElement){
          console.log("Entered Fullscreen Somewhere")
        }
        else {
          console.log("Leaving Fullscreen Somewhere")
          url = window.location.href;
          url = url.replace("#fullscreen", "");
          window.location.href = url;
        }
      }
      function openFullscreen() {
        let GAMETYPE = document.getElementById("GAMETYPE").value;
        switch (GAMETYPE) {
          case "flash":
            console.log("Fullscreen Flash Content");
            document.getElementById("GameElement").enterFullscreen();
            break;
          case "html5":
            console.log("Fullscreen HTML5 Content");
            document.getElementById("GameElement").requestFullscreen();
              break;
          default:
            console.log("Do Nothing");
            break;
        }
      }
      function showGameBody(){
        document.getElementById("MainBody").style.display = "none";
        document.getElementById("GameBody").style.display = "block";
        document.getElementById("SuggestionButton").style.display = "none";
        document.getElementById("BugButton").style.display = "block";
        let url = document.getElementById("GAMEURL").value;
        console.log(url);
        let matched = false;
        let index = 0;
        for (let bindex = 0; bindex < gameData.games.length; bindex++) {
          if (url == gameData.games[bindex].url) {
            matched = true;
            index = bindex;
          }
        }
        if(matched){
          console.log("Matched");
          name = gameData.games[index].name;
          document.getElementById("title").innerHTML = name + " - Dunkin's Games";
          document.getElementById("subTEXT").innerHTML = name;
          let parsestring = "";
          let descstring = "";
          if(gameData.games[index].isWorking){
            switch (gameData.games[index].data.gameType){
              case "flash":
                parsestring = '<object value="flash" name="GameElement" id="GameElement" type="application/x-shockwave-flash" data="games/' + gameData.games[index].data.gameFile + '" width="' + gameData.games[index].data.width + '" height="' + gameData.games[index].data.height + '"><param id="MovieValue" name="movie" value="games/' + gameData.games[index].data.gameFile + '" /><param name="quality" value="high" /><param name="play" value="true" /><param name="loop" value="true" /><param name="wmode" value="window" /><param name="scale" value="showall" /><param name="menu" value="true" /><param name="devicefont" value="false" /><param name="salign" value="" /><param name="allowScriptAccess" value="sameDomain" /><param name="allowFullScreen" value="true" /></object>';
                console.log("This A Flash Game");
                break;
              case "html5":
                parsestring = '<div value="html5" name="GameElement" id="GameElement" style="width:' + gameData.games[index].data.width + 'px; height:' + gameData.games[index].data.height + 'px;" bis_skin_checked="1"><iframe id="iframe" width="100%" height="100%" src=games/' + gameData.games[index].url + '/' + gameData.games[index].data.gameFile + ' tabindex="0" scrolling="no" style="border: none; overflow: hidden" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div>';
                console.log("This A HTML5 Game");
                break;
              default:
                console.log("This Nothing");
                break;
            }
            descstring = "<table class='daTbl'><tr><th style='font-size: 24px;'>Game Description</th></tr><tr><td style='font-size: 16px;'>" + gameData.games[index].description + "</td></tr></table>";
            document.getElementById("FullscreenButton").style.display = "block";
          }
          else{
            parsestring = '<img id="GameElement" src="images/fixing.png" alt="Look At Him Go!" width="500" height="350">';
            descstring = "<table class='daTbl'><tr><th style='font-size: 24px;'>Game Description</th></tr><tr><td style='font-size: 16px;'>This Game Is Currently Not Working, Check Back Later And See If It's Working Again!</td></tr></table>";
          }
          parser = new DOMParser();
          doc = parser.parseFromString(parsestring, 'text/html');
          element = doc.body.firstChild;
          doc2 = parser.parseFromString(descstring, 'text/html');
          descElement = doc2.body.firstChild;
          document.getElementById("GameWindow").appendChild(element);
          document.getElementById("DescriptionBox").appendChild(descElement);
          document.getElementById("GAMETYPE").value = gameData.games[index].data.gameType;
          document.getElementById("subTEXT").scrollIntoView({ behavior: 'smooth'})
          console.log("Done!");
        }
        else{
          console.log("Error");
          descstring = "<table class='daTbl'><tr><th style='font-size: 24px;'>Game Description</th></tr><tr><td style='font-size: 16px;'>Something Went Wrong. Either This Game URL Has Changed Or It Does Not Exist Anymore, Sorry About That!</td></tr></table>";
          document.getElementById("title").innerHTML = "An Error Occured - Dunkin's Games";
          document.getElementById("subTEXT").innerHTML = "<!> Error <!>";
          parsestring = '<img id="GameElement" src="images/hmm.png" alt="Hmm..." width="500" height="500">';
          parser = new DOMParser();
          doc = parser.parseFromString(parsestring, 'text/html');
          element = doc.body.firstChild;
          document.getElementById("GameWindow").appendChild(element);
          doc2 = parser.parseFromString(descstring, 'text/html');
          descElement = doc2.body.firstChild;
          document.getElementById("DescriptionBox").appendChild(descElement);
          document.getElementById("subTEXT").scrollIntoView({ behavior: 'smooth'})
        }	
      }
      var gameData = {};
      let menuOpen = false;
      
      fetch("gameData.json").then(response => response.json()).then(data => {
        gameData = data;
        let urlLocation = window.location.href;
        urlLocation = urlLocation.split("/");
        if(urlLocation[urlLocation.length - 1].includes("#") === true){
          urlLocation2 = urlLocation[urlLocation.length - 1]
          fullscreenchanged(null);
          final = urlLocation2.split("#");
          if (final[final.length - 1] === ""){
            showMainBody();
          }
          else{
            if(final[final.length - 1] === "fullscreen"){
              setURL(final[final.length - 2]);
            }
            else{
              setURL(final[final.length - 1]);
            }
          }
        }
        else{
          showMainBody();
        }
        document.addEventListener("fullscreenchange", fullscreenchanged);
        makeMenuList();
      })

      document.addEventListener("keydown", 
      function (event) { 
          if (event.key === "`") { 
              event.preventDefault();
              if (menuOpen === false){
                openOverlayMenu();
              }
              else{
                closeOverlayMenu();
              }
          } 
      }); 
    </script>
  </body>
</html>
